plugin.onLoad(async () => {
	new MutationObserver(() => {
		if (!document.querySelector('.m-pinfo .bar .btns')) return;
		if (document.querySelector('.m-pinfo .bar .btns .btn-osu')) return;
		const prev = document.querySelector('.m-pinfo .bar .btns .btn-share');
		const btn = document.createElement('div');
		btn.className = 'z-off btn btn-osu';
		btn.title = '在 osu! 中搜索';
		btn.innerHTML = `
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300">
				<path d="M100.129,206.421a30.282,30.282,0,0,1-12.286-2.3,23.274,23.274,0,0,1-8.64-6.4,27.844,27.844,0,0,1-5.162-9.594,39.218,39.218,0,0,1-1.739-11.9,40.332,40.332,0,0,1,1.739-12.006,27.736,27.736,0,0,1,5.162-9.706,23.848,23.848,0,0,1,8.64-6.452,29.643,29.643,0,0,1,12.286-2.356,30.056,30.056,0,0,1,12.344,2.356,24.3,24.3,0,0,1,8.752,6.452,26.639,26.639,0,0,1,5.162,9.706,41.633,41.633,0,0,1,1.682,12.006,40.481,40.481,0,0,1-1.682,11.9,26.721,26.721,0,0,1-5.162,9.594,23.715,23.715,0,0,1-8.752,6.4A30.705,30.705,0,0,1,100.129,206.421Zm0-12.119q6.283,0,9.033-4.657t2.749-13.409q0-8.751-2.749-13.408t-9.033-4.657q-6.171,0-8.92,4.657T88.46,176.236q0,8.752,2.749,13.409T100.129,194.3Zm51.727-14.475a22.2,22.2,0,0,1-9.818-5.329q-3.534-3.536-3.534-10.6,0-8.528,6.115-13.353t16.662-4.825a47.667,47.667,0,0,1,8.641.786,55.091,55.091,0,0,1,8.639,2.356,30.641,30.641,0,0,1-1.121,6.059,29.166,29.166,0,0,1-2.132,5.5,44.584,44.584,0,0,0-5.947-1.963,27.254,27.254,0,0,0-6.845-.842,12.424,12.424,0,0,0-5.948,1.178,3.983,3.983,0,0,0-2.131,3.759,3.868,3.868,0,0,0,1.514,3.479,17.694,17.694,0,0,0,4.32,1.907l6.4,1.908a31.515,31.515,0,0,1,5.666,2.188,15.64,15.64,0,0,1,4.32,3.2,13.418,13.418,0,0,1,2.806,4.712,20.365,20.365,0,0,1,1.01,6.845,17.5,17.5,0,0,1-1.741,7.742,17.857,17.857,0,0,1-5.048,6.228,25.009,25.009,0,0,1-8.023,4.152A34.769,34.769,0,0,1,155,206.421q-2.692,0-4.938-.169a38.757,38.757,0,0,1-4.32-.561q-2.078-.393-4.1-.954t-4.375-1.458a32.174,32.174,0,0,1,1.066-6.116,38.475,38.475,0,0,1,2.188-6,46.473,46.473,0,0,0,7.013,2.189,31.926,31.926,0,0,0,6.9.729,22.959,22.959,0,0,0,3.422-.281,12.48,12.48,0,0,0,3.422-1.01,8.1,8.1,0,0,0,2.637-1.907,5.23,5.23,0,0,0-.561-6.957,15.718,15.718,0,0,0-4.545-2.076Zm39.384-32.765a47.493,47.493,0,0,1,15.934,0v30.746a32.548,32.548,0,0,0,.729,7.574,11.1,11.1,0,0,0,2.244,4.713,8.26,8.26,0,0,0,3.759,2.467,17.025,17.025,0,0,0,5.274.73,26.208,26.208,0,0,0,6.957-.785V147.062a47.831,47.831,0,0,1,7.854-.673,48.486,48.486,0,0,1,7.967.673V202.83a75.877,75.877,0,0,1-9.481,2.412,62.483,62.483,0,0,1-12.287,1.179,65.512,65.512,0,0,1-11-.9,21.51,21.51,0,0,1-9.257-3.815,19.672,19.672,0,0,1-6.339-8.528q-2.358-5.61-2.357-14.923Zm65.866,58.012a51.073,51.073,0,0,1-.673-8.191,53.223,53.223,0,0,1,.673-8.3,51.2,51.2,0,0,1,8.191-.673,53.335,53.335,0,0,1,8.3.673,52.55,52.55,0,0,1,.672,8.191,51.752,51.752,0,0,1-.672,8.3,52.548,52.548,0,0,1-8.192.673A51.76,51.76,0,0,1,257.106,205.074Zm-.449-80.678a56.72,56.72,0,0,1,8.64-.673,57.467,57.467,0,0,1,8.753.673l-1.122,54.871a44.629,44.629,0,0,1-7.519.672,43.887,43.887,0,0,1-7.63-.672Z" transform="translate(-24.999 -25)"/>
				<path d="M175,25A150,150,0,1,0,325,175,150,150,0,0,0,175,25Zm0,285A135,135,0,1,1,310,175,135,135,0,0,1,175,310Z" transform="translate(-24.999 -25)"/>
			</svg>
		`;
		btn.addEventListener('click', () => {
			const songInfo = betterncm.ncm.getPlayingSong();
			const songName = songInfo.data.name;
			const artist = songInfo.data.artists.map(artist => artist.name).join(' ');
			const url = `https://osu.ppy.sh/beatmapsets?q=${encodeURIComponent(`${songName} ${artist}`)}`;
			betterncm.app.exec(url);
		});

		prev.parentNode.insertBefore(btn, prev.nextSibling);
	}).observe(await betterncm.utils.waitForElement('.m-pinfo'), { childList: true, subtree: true });
});